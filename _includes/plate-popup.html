<!-- ============================= -->
<!-- FOOD & FERTILITY PLATE POPUP  -->
<!-- ============================= -->

<style>
  /* Popup button behavior ONLY — keep site sizing/shape */
  #ff-popup-overlay .custom-btn {
    background-color: #1d4939 !important;
    color: #ffffff !important;
    font-family: 'Montserrat', sans-serif !important;
  }

  #ff-popup-overlay .custom-btn:hover,
  #ff-popup-overlay .custom-btn:active,
  #ff-popup-overlay .custom-btn:focus,
  #ff-popup-overlay .custom-btn:focus-visible {
    background-color: #f7980f !important;
    color: #ffffff !important;
    outline: none !important;
  }

  #ff-popup-overlay .custom-btn:visited {
    color: #ffffff !important;
  }

  /* Hide footer copyright bar ONLY while popup is active */
  body.ff-popup-active .footer-bottom,
  body.ff-popup-active .footer-bottom-area,
  body.ff-popup-active .footer-copyright {
    display: none !important;
  }

  /* Mobile stacking */
  @media (max-width: 640px) {
    #ff-popup {
      flex-direction: column !important;
      align-items: flex-start !important;
    }
    #ff-popup-actions {
      width: 100%;
    }
    #ff-popup-overlay .custom-btn {
      width: 100%;
      text-align: center;
    }
  }
</style>

<div
  id="ff-popup-overlay"
  style="
    position: fixed;
    left: 16px;
    right: 16px;
    bottom: 16px;
    z-index: 9999;
    display: none;
    justify-content: center;
  "
>
  <div
    id="ff-popup"
    style="
      position: relative;
      max-width: 900px;
      width: 100%;
      background: #ffffff;
      border-radius: 18px;
      border: 1px solid rgba(29, 73, 57, 0.12);
      box-shadow: 0 14px 40px rgba(0, 0, 0, 0.14);
      padding: 20px 22px;
      display: flex;
      justify-content: space-between;
      gap: 20px;
      align-items: center;
      font-family: 'Montserrat', sans-serif;
    "
  >
    <!-- Close button -->
    <button
      type="button"
      id="ff-popup-close"
      aria-label="Close popup"
      style="
        position: absolute;
        top: 10px;
        right: 12px;
        background: none;
        border: none;
        font-size: 22px;
        cursor: pointer;
        line-height: 1;
        color: #1d4939;
        font-family: 'Montserrat', sans-serif;
      "
    >
      ×
    </button>

    <!-- Text -->
    <div style="display:flex;flex-direction:column;gap:6px;padding-right:10px;">
      <h2
        style="
          margin: 0;
          font-size: 1.25rem;
          font-weight: 700;
          color: #1d4939;
          font-family: 'Montserrat', sans-serif;
        "
      >
        Download The Fertility Plate — free
      </h2>

      <div
        style="
          font-size: 0.95rem;
          color: #333;
          font-family: 'Montserrat', sans-serif;
        "
      >
        A simple guide to building meals that support fertility.
      </div>
    </div>

    <!-- CTA -->
    <div
      id="ff-popup-actions"
      style="display:flex;align-items:center;gap:10px;flex-shrink:0;"
    >
      <a
        id="ff-popup-download"
        href="/assets/downloads/fertility-plate.pdf"
        class="custom-btn"
      >
        Download
      </a>
    </div>
  </div>
</div>

<script>
  (function () {
    const SHOW_DELAY_MS = 8000;
    const HIDE_AFTER_CLOSE_DAYS = 7;
    const HIDE_AFTER_DOWNLOAD_DAYS = 30;
    const KEY_HIDE_UNTIL = "ff_popup_hide_until_ts";

    function now() {
      return Date.now();
    }
    function daysToMs(days) {
      return days * 24 * 60 * 60 * 1000;
    }
    function shouldShow() {
      const until = parseInt(localStorage.getItem(KEY_HIDE_UNTIL) || "0", 10);
      return now() > until;
    }
    function setHide(days) {
      localStorage.setItem(KEY_HIDE_UNTIL, String(now() + daysToMs(days)));
    }

    function showPopup() {
      const popup = document.getElementById("ff-popup-overlay");
      if (popup) {
        popup.style.display = "flex";
        document.body.classList.add("ff-popup-active");
      }
    }

    function hidePopup() {
      const popup = document.getElementById("ff-popup-overlay");
      if (popup) {
        popup.style.display = "none";
        document.body.classList.remove("ff-popup-active");
      }
    }

    if (shouldShow()) {
      setTimeout(showPopup, SHOW_DELAY_MS);
    }

    const closeBtn = document.getElementById("ff-popup-close");
    if (closeBtn) {
      closeBtn.addEventListener("click", function () {
        hidePopup();
        setHide(HIDE_AFTER_CLOSE_DAYS);
      });
    }

    const downloadBtn = document.getElementById("ff-popup-download");
    if (downloadBtn) {
      downloadBtn.addEventListener("click", function () {
        hidePopup();
        setHide(HIDE_AFTER_DOWNLOAD_DAYS);
      });
    }
  })();
</script>
